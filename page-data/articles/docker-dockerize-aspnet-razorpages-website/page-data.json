{
    "componentChunkName": "component---src-pages-articles-mdx-slug-js",
    "path": "/articles/docker-dockerize-aspnet-razorpages-website/",
    "result": {"data":{"mdx":{"frontmatter":{"title":"Dockerize an ASP.NET Core Application","date":"May 14, 2022"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Dockerize an ASP.NET Core Application\",\n  \"date\": \"2022-05-14\",\n  \"tags\": [\"docker\", \"Razor Pages\", \"ASP.NET Core\", \"C#\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Visual Studio provides excellent support for docker containers, but this does mean some of the complexities of the technology can get masked. In this tutorial we walk through the basics of building a docker container for a simple ASP.NET Core Web Application so that we can better understand the underlying principles of docker.\"), mdx(\"h3\", null, \"Docker Overview\"), mdx(\"p\", null, \"Docker is a containerisation technology that consists of images and containers. An image is a read-only template with instructions for creating a Docker container. A container is a runnable instance of an image. To build an image we write a Dockerfile which has a simple syntax for defining the required steps. You can learn more about docker from the official documentation:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://docs.docker.com/get-started/overview/\"\n  }, \"Docker Overview\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://docs.docker.com/engine/reference/builder/\"\n  }, \"Dockerfile reference\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://docs.docker.com/engine/reference/commandline/build/\"\n  }, \"docker build\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://docs.docker.com/engine/reference/commandline/run/\"\n  }, \"docker run\"))), mdx(\"p\", null, \"In order to build and run docker containers you need to install \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.docker.com/desktop/\"\n  }, \"Docker Desktop\"), \".\"), mdx(\"h3\", null, \"Creating the Application\"), mdx(\"p\", null, \"Before we create our application a quick word about the solution structure. One of the benefits of docker is  that it helps to separate the application from its infrastructure. Consequently we will create two folders in the root of our repository one for our source code and the other for the docker related files.\"), mdx(\"p\", null, \"At the root of our repository, create a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"src\"), \" folder, for our application, and a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"docker\"), \" folder, for our infrastructure. \"), mdx(\"p\", null, \"Next create a .net 6.0 website using the  ASP.NET Core Web App template called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AspNetWebDocker\"), \" in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"src\"), \" folder and add an empty file called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \" in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"docker\"), \" folder. We will write the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \" shortly. The directory structure should now look similar to below:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"C:\\\\AspNetWebDocker\\n\\u251C\\u2500\\u2500\\u2500docker\\n\\u2502       Dockerfile\\n\\u2502\\n\\u2514\\u2500\\u2500\\u2500src\\n    \\u2502   AspNetWebDocker.sln\\n    \\u2502\\n    \\u2514\\u2500\\u2500\\u2500AspNetWebDocker\\n\")), mdx(\"h3\", null, \"Building the Solution\"), mdx(\"p\", null, \"In the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \" we are going to write the steps to restore, build and then run our application. Before writing and running the container, its worth running the same steps in a console window to check everything works. Execute the equivalent commands below:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-powershell\"\n  }, \"cd .\\\\src\\\\AspNetWebDocker\\\\\\ndotnet restore\\ndotnet publish -c Release -o app\\ndotnet .\\\\app\\\\AspNetWebDocker.dll\\n\")), mdx(\"p\", null, \"If you execute these commands in the terminal, you should see something like below:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"817px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/da013d276e6fc7ff6fac8cf97b037e38/98314/restore-build-run-native-screenshot.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"62.66666666666667%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7CAAAOwgEVKEqAAAABlklEQVQ4y5VSa2vCQBA8FcE3+H4kmkTzMImJiOCvVGpDakv7wZ86ZRYuWKHVfhj2bo+b3dlZdXn/wNfXJy6XC67XK7LsFefzC/L8DXmeI8synE4nHI/Hp6DiOMZms4HrrrBcLuHYc5jmFLPZDJ1OB/V6HeVyGaVSCZVK5SFUkiTYbreIoggkD8MAcRwgCALM53MpwjgajdBqtaRIu93+FcrzPNi2Ddd15bPve7CsBabTKRzHkTfdbbPZFNK/oEjEj5ZlYbFYSByPxxgMBiKXaDQaT5EJIauzG0ai2+0K+Fir1QpSgvfb3P2dhZXv+yKVZIZhwHFs6ZjdMmeaZlGQ7zrPHN8I3rUqtd/vcTgcQOIwDLHbpUiTUAyiWcR6vcZqtRIyFqNJJOJ89agmkwl6vR6U7VjymS7TWZJGUSzdDIdDVKvVH/IeSnY9F2maFqTcSXakJfb7/cIQxlvc5gpTvMATWdxHkmpyGkMJJOTKPAJ3kMTKMA0xheA8OCPOizPRoAE66s5pAnM86+0QwvtZ6DPn8R9o2d8XDWHLC37iOQAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Restore/Build/Run Screenshot\",\n    \"title\": \"Restore/Build/Run Screenshot\",\n    \"src\": \"/static/da013d276e6fc7ff6fac8cf97b037e38/98314/restore-build-run-native-screenshot.png\",\n    \"srcSet\": [\"/static/da013d276e6fc7ff6fac8cf97b037e38/5a46d/restore-build-run-native-screenshot.png 300w\", \"/static/da013d276e6fc7ff6fac8cf97b037e38/0a47e/restore-build-run-native-screenshot.png 600w\", \"/static/da013d276e6fc7ff6fac8cf97b037e38/98314/restore-build-run-native-screenshot.png 817w\"],\n    \"sizes\": \"(max-width: 817px) 100vw, 817px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Now that we know what commands we need to run, we can write the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \".\"), mdx(\"h3\", null, \"Building the Docker Image\"), mdx(\"p\", null, \"Before we can run our container we need to build an image and we create an image by building it from a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \". So the next step is to write a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \". \"), mdx(\"p\", null, \"A \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \" is a series of commands that the docker build command uses to create an image. Copy the following text into the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"docker/Dockerfile\"), \" we created above:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-dockerfile\"\n  }, \"FROM mcr.microsoft.com/dotnet/sdk:6.0 AS base\\nENV ASPNETCORE_URLS=http://+:80\\nWORKDIR /app\\nCOPY ./src .\\nRUN dotnet restore\\nRUN dotnet publish -c Release -o out \\nWORKDIR /app/out\\nENTRYPOINT [\\\"dotnet\\\", \\\"AspNetWebDocker.dll\\\"]\\n\")), mdx(\"p\", null, \"For a complete overview of all \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \" commands you can see the docker documentation: \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.docker.com/engine/reference/builder/\"\n  }, \"Dockerfile reference\"), \". A brief description of each step:\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Keyword\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Meaning\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"a\", {\n    parentName: \"td\",\n    \"href\": \"https://docs.docker.com/engine/reference/builder/#from\"\n  }, \"FROM\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Sets the base image that our image will be built from. Its pulled from a \", mdx(\"a\", {\n    parentName: \"td\",\n    \"href\": \"https://hub.docker.com/_/microsoft-dotnet-sdk\"\n  }, \"docker repository\"))), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"a\", {\n    parentName: \"td\",\n    \"href\": \"https://docs.docker.com/engine/reference/builder/#workdir\"\n  }, \"WORKDIR\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Set the working directory for our new image to the app folder\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"a\", {\n    parentName: \"td\",\n    \"href\": \"https://docs.docker.com/engine/reference/builder/#copy\"\n  }, \"COPY\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Copy all files from the src folder into our container\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"a\", {\n    parentName: \"td\",\n    \"href\": \"https://docs.docker.com/engine/reference/builder/#run\"\n  }, \"RUN\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Run the restore and publish commands creating the application files\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"a\", {\n    parentName: \"td\",\n    \"href\": \"https://docs.docker.com/engine/reference/builder/#workdir\"\n  }, \"WORKDIR\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Set the working directory to the out folder just created\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"a\", {\n    parentName: \"td\",\n    \"href\": \"https://docs.docker.com/engine/reference/builder/#entrypoint\"\n  }, \"ENTRYPOINT\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Start the \", mdx(\"inlineCode\", {\n    parentName: \"td\"\n  }, \"dotnet\"), \" application when the container starts\")))), mdx(\"p\", null, \"Next we need to build the docker image from the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \" using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"docker build\"), \" command. The docker client tools are provided as part of the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.docker.com/desktop/\"\n  }, \"Docker Desktop\"), \" application. We run the following command \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"from the root of our repository\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"docker build -f docker\\\\Dockerfile -t aspnetweb01 .\\n\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"-f\"), \" switch specifies the path to the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Dockerfile\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"-t \"), \" switch gives the new image the name \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"aspnetweb01\"), \" \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \".\"), \"  sets the build context to be the current folder\")), mdx(\"p\", null, \"Once the image is built we can use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"docker images\"), \" command to see our newly built image in the local image repository:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1119px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/4b9bca522b749830e8de86c3a7c265da/33a7b/docker-images-screenshot.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"17.333333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAr0lEQVQI1yXIwQqCMACAYXGzS21WugzKnBVsy4qEEu0t1oqpZEFaYJfe/xYU/IeP32ib1+f9bh91Wzev++15K+prVahTLmV5Pmsp81+V1qVShVKV1v95vVyMdL7YTKYEQhdAFwBiWZ7VGUHLNcHW92cIuSYgAMYBTRkT3viwXDJC/G43Y9xgYsWFYJxH6zXjfOg4CGNs2wjjgNL+YPD3Koqy43FG6S6OaRj2ENonyRdi4yHDyyqdrgAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Docker Image Screenshot\",\n    \"title\": \"Docker Image Screenshot\",\n    \"src\": \"/static/4b9bca522b749830e8de86c3a7c265da/33a7b/docker-images-screenshot.png\",\n    \"srcSet\": [\"/static/4b9bca522b749830e8de86c3a7c265da/5a46d/docker-images-screenshot.png 300w\", \"/static/4b9bca522b749830e8de86c3a7c265da/0a47e/docker-images-screenshot.png 600w\", \"/static/4b9bca522b749830e8de86c3a7c265da/33a7b/docker-images-screenshot.png 1119w\"],\n    \"sizes\": \"(max-width: 1119px) 100vw, 1119px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Looks like our image has been built succesfully so now we can use it to run a container.\"), mdx(\"h3\", null, \"Running the Container\"), mdx(\"p\", null, \"We can use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"docker run\"), \" command to start our new container using the image that we just created above as the template:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"docker run -d -p 5051:80 --name webapp aspnetweb01\\n\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"-d\"), \" switch sets the container running in the background\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"-p\"), \" switch maps the local port, the port of the container, to the port of the \\\"host\\\" system. We can access our new site on port 5051\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"We also specify the name of the container \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"webapp\"), \" and also the name of the image \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"aspnetweb01\"))), mdx(\"p\", null, \"So navigate to the url \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http://localhost:5051\"), \" in your browser and you should see your website displayed. If you have any problems loading the website, try tailing the logs as described in the debugging section below.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note\"), \" on line 2 of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \" we specify that the the container should have an environment variable of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ASPNETCORE_URLS\"), \" with the value \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http://+:80\"), \". So our application binds to port 80 inside the container and we then use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"-p\"), \" switch map that to a port on the host system. We do need to specify this variable to avoid getting the following error:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"Unable to bind to http://localhost:5000 on the IPv6 loopback interface: 'Cannot assign requested address'.\\n\")), mdx(\"p\", null, \"This error is because the kestral webserver cannot bind to the localhost IPv6 address. By specifying the environment variable it binds to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"127.0.0.1\"), \" instead.\"), mdx(\"h3\", null, \"Optimising  the Container\"), mdx(\"p\", null, \"Our simple \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \" does work, but for production scenarios we really want to try to get that image size down in order to optimise our container. There are a number of steps that we can take to do this:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use a musl linux base image like \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://www.alpinelinux.org/\"\n  }, \"alpine\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://docs.docker.com/develop/develop-images/multistage-build/\"\n  }, \"multi-stage docker builds\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use the publish trimmed option \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"dotnet publish\"), \" options\")), mdx(\"p\", null, \"The following \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \" uses these techniques and will create a much smaller image size:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-dockerfile\"\n  }, \"FROM alpine:3.15 AS base\\n  WORKDIR /app\\n\\nFROM mcr.microsoft.com/dotnet/sdk:6.0 AS publish\\n  WORKDIR /src\\n  COPY . .\\n  WORKDIR /src/src/Web\\n  RUN dotnet restore \\\"AspNetDockerWeb.csproj\\\" --runtime linux-musl-x64\\n  RUN dotnet publish \\\"AspNetDockerWeb.csproj\\\" -c Release -o /app/publish /p:PublishTrimmed=true --runtime linux-musl-x64 --self-contained /p:DebugType=None \\n\\nFROM base AS final\\n  ENV ASPNETCORE_URLS=http://+:80\\n  WORKDIR /app  \\n  RUN apk update && \\\\      \\n      apk add libstdc++   \\n  COPY --from=publish /app/publish .\\n  CMD ./AspNetDockerWeb\\n\")), mdx(\"p\", null, \"Before we build and run this image however, there is a further change that we need to make to our website. The code will currently error with a gobalization issue similar to:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"Process terminated. Couldn't find a valid ICU package installed on the system. Set the configuration flag System.Globalization.Invariant to true if you want to run with no globalization support.\\n   at System.Environment.FailFast(System.String)\\n   at System.Globalization.GlobalizationMode.GetGlobalizationInvariantMode()\\n   at System.Globalization.GlobalizationMode..cctor()\\n\")), mdx(\"p\", null, \"To fix this issue we add a file at the root of the web project called \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"em\", {\n    parentName: \"strong\"\n  }, \"runtimeconfig.template.json\")), \" and add the json below. For more information review the related \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/dotnet/core/issues/2186#issuecomment-472629489\"\n  }, \"github issue\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\"\n  }, \"{\\n    \\\"configProperties\\\": {\\n        \\\"System.Globalization.Invariant\\\": true\\n    }\\n}\\n\")), mdx(\"p\", null, \"Now build the image as described above use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"docker images\"), \" command. The size has dropped from 773mb to 55.7mb\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1121px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/a4d1964293c1022fbbbca4dd4f95f438/bb3ba/docker-images-musl-screenshot.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"14.666666666666666%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAArklEQVQI1yXIOw6CMAAAUDbFghGkVMAapEkBqWXQRePk7UyMs0A/kihaT+ng9vKs18c8h+H9NYMx8qF03wutO6U6pVop//hPI4TQupHy3nWtFJfrzTrzmi2iEsLc90vobcIwc6fL0ZgtomIerOwJHtsVQkealwHcpymPkxKGPIoP1daqKKVpuiGkyAjy/NkEzF3XAyDDeImQ7zgeAATj8+nEKGU033G+ThJeFDXjP3NzM2z6AhznAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Docker musl Image Screenshot\",\n    \"title\": \"Docker musl Image Screenshot\",\n    \"src\": \"/static/a4d1964293c1022fbbbca4dd4f95f438/bb3ba/docker-images-musl-screenshot.png\",\n    \"srcSet\": [\"/static/a4d1964293c1022fbbbca4dd4f95f438/5a46d/docker-images-musl-screenshot.png 300w\", \"/static/a4d1964293c1022fbbbca4dd4f95f438/0a47e/docker-images-musl-screenshot.png 600w\", \"/static/a4d1964293c1022fbbbca4dd4f95f438/bb3ba/docker-images-musl-screenshot.png 1121w\"],\n    \"sizes\": \"(max-width: 1121px) 100vw, 1121px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"h3\", null, \"Debugging the Container\"), mdx(\"p\", null, \"Getting a docker container up and running can be a fiddly task. There are a couple of techniques to use to try to debug any issues.\"), mdx(\"p\", null, \"Tail the logs to see what the application is doing:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"docker logs webapp -f\\n\")), mdx(\"p\", null, \"Connect to the container to run shell commands. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"# Debian\\ndocker exec -it webapp bash \\n\\n# Alpine\\ndocker exec -it webapp sh\\n\")), mdx(\"h3\", null, \"Docker Commands Cheat sheet\"), mdx(\"p\", null, \"The following commands have been used throughout this tutorial:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"# Build the docker image:\\ndocker build -f docker\\\\Dockerfile -t aspnetweb01 .\\n\\n# Run a docker container:\\ndocker run -d -p 5051:80 --name webapp aspnetweb01\\ndocker run -d -p 5050:5000 -e ASPNETCORE_URLS=http://+:5000 --name webapp aspnetweb01\\n\\n# Show all containers:\\ndocker ps -a\\n\\n# Show all images:\\ndocker images\\n \\n# Stop the container and remove it and the image:\\ndocker stop webapp\\ndocker rm webapp\\ndocker rmi aspnetweb01\\n\\n# Tail the logs of the container:\\ndocker logs webapp -f\\n\\n# Log into the container:\\ndocker exec -it webapp bash\\n\")), mdx(\"h3\", null, \"Conclusion\"), mdx(\"p\", null, \"In this tutorial we started looking at how to build and run a basic Docker container before looking into a more useful multi-build, optimised scenario. This optimised image is a more realistic starting point for production systems but we have only scratched the surface of what Docker can be used for. \"), mdx(\"p\", null, \"Debugging containers can be fiddly, and it might take some time to understand what the different commands in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Dockerfile\"), \" is actually do but tailing the logs and connecting on to the container are two useful techniques to help.\"), mdx(\"p\", null, \"Finally the Docker documentation is excellent and I strongly suggest having a read through to familiarise yourself with the concepts and how to write solutions for more complex scenarios. The links at the beginning of this article are a great starting point.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"b3d5c95c-2bba-54bb-9592-d63284b7dbda","slug":"docker-dockerize-aspnet-razorpages-website","__params":{"slug":"docker-dockerize-aspnet-razorpages-website"}}},
    "staticQueryHashes": ["3159585216"]}